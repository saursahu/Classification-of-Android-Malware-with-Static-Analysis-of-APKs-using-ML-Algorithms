# -*- coding: utf-8 -*-
"""
Spyder Editor

This is a temporary script file.
"""
from apk import APK
from util import read
import csv
import os

list_of_permissions=["android.permission.WRITE_CALENDAR","android.permission.RECEIVE_WAP_PUSH",
                     "android.permission.ADD_VOICEMAIL","android.permission.RECORD_AUDIO",
                     "android.permission.ACCESS_COARSE_LOCATION", "android.permission.CAMERA",
                     "android.permission.WRITE_EXTERNAL_STORAGE","android.permission.WRITE_CALL_LOG",
                     "android.permission.READ_EXTERNAL_STORAGE","android.permission.PROCESS_OUTGOING_CALLS",
                     "android.permission.RECEIVE_SMS", "android.permission.WRITE_CONTACTS",
                     "android.permission.SEND_SMS","android.permission.READ_SMS",
                     "android.permission.CALL_PHONE","android.permission.READ_PHONE_STATE",
                     "android.permission.RECEIVE_MMS", "android.permission.BODY_SENSORS",
                     "android.permission.READ_CONTACTS", "android.permission.READ_CALL_LOG",
                     "android.permission.USE_SIP", "android.permission.READ_CALENDAR",
                     "android.permission.READ_CALENDAR", "android.permission.ACCESS_FINE_LOCATION",
                     "android.permission.GET_ACCOUNTS"]

def get_filepaths(directory):
    file_paths=[]
    
    for root,directories, files in os.walk(directory):
        for filename in files:
            filepath=os.path.join(root, filename)
            if(filepath.endswith(".apk")):
                file_paths.append(filepath)
            
    return file_paths

def write_to_csv(apk_paths):
    
    for file_path in apk_paths:
        obj=APK(file_path)
        obj=APK(read(file_path), raw=True)
    
        list_of_obtained_permissions=obj.get_permissions()
        #print(list_of_obtained_permissions)
        
        result=[]
        for permission in list_of_permissions:
            if permission in list_of_obtained_permissions:
                result.append(1)
            else: result.append(0)
        
        package_name=obj.get_package()
        result.append(package_name)
        
        package_size=obj.file_size
        result.append(package_size)
        
        result.append(1)
        
        with open("./saurabh_dataset.csv", "a") as f:
            writer = csv.writer(f, dialect='excel')
            writer.writerow(result)
        
    

full_apk_paths=get_filepaths("./APKs/SMSmalware")
write_to_csv(full_apk_paths)

    
        



    
    
    
        
